@page "/history"
@inject IAccountService AccountService;
@inject IStorageService StorageService;
@using BlazorStandaloneApp.Domain


<PageTitle>History</PageTitle>

<h1>History</h1>

    <table class="accounts-table">
        <thead>
            <tr>
                <th>Action</th>
                <th>Amount</th>
                <th>From</th>
                <th>To</th>
                <th>Account Balance</th>
                <th>Last updated</th>
            </tr>
        </thead>
        <tbody> 
        @foreach (var transaction in _transactions)
        {
            <tr>
                <td>@transaction.Type</td>
                <td>@transaction.Amount</td>
                <td>@GetAccountName(transaction.FromAccount)</td>
                <td>@GetAccountName(transaction.ToAccount)</td>
                <td>@transaction.BalanceAfterTransaction</td>
                <td>@transaction.DateTime.ToLocalTime()</td>
            </tr>
        }
        </tbody>
    </table>


@code
{
    private List<BankAccount> _accounts = new();
    private List<Transaction> _transactions = new();
     protected override async Task OnInitializedAsync()
    {
        _accounts = await AccountService.GetAccounts();
        _transactions = await StorageService.GetItemAsync<List<Transaction>>("transactions") ?? new List<Transaction>();
    }


    // Chat: find the names by ID

    private string GetAccountName(Guid? accountId)
{
    if (accountId == null)
        return "-"; // for transactions without one (e.g. deposits)

    var account = _accounts.FirstOrDefault(a => a.Id == accountId);
    return account?.Name ?? accountId.ToString(); // fallback to ID if missing
}
}